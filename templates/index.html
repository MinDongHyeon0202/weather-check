<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê±´ì„¤ ê³µì • íŒë‹¨ ì‹œìŠ¤í…œ</title>
</head>

<body>
  <div class="container">
    <h1>ê±´ì„¤ ê³µì • íŒë‹¨ ì‹œìŠ¤í…œ ğŸŒ¦ï¸</h1>

    {% if location %}
      <p>ğŸ“ í˜„ì¬ ìœ„ì¹˜: <strong>{{ location }}</strong></p>
    {% endif %}

    {% if lat and lon and gmap_key %}
      <h3>ğŸ—ºï¸ í˜„ì¬ ìœ„ì¹˜ ì§€ë„ (Google Maps)</h3>
      <img
        src="https://maps.googleapis.com/maps/api/staticmap?center={{ lat }},{{ lon }}&zoom=14&size=600x300&markers=color:red%7Clabel:A%7C{{ lat }},{{ lon }}&key={{ gmap_key }}"
        alt="Google ì§€ë„"
      />
    {% endif %}

    <form method="POST">
      <label for="task">ê³µì •ì„ ì„ íƒí•˜ì„¸ìš”:</label>
      <select name="task" id="task" required>
        {% for t in tasks %}
          <option value="{{ t }}" {% if selected_task == t %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>

      <input type="hidden" name="lat" id="lat" />
      <input type="hidden" name="lon" id="lon" />

      <button type="submit">íŒë‹¨í•˜ê¸°</button>
    </form>

    {% if result %}
      <p>ğŸ“‹ íŒë‹¨ ê²°ê³¼: {{ result }}</p>
    {% endif %}

    {% if forecast %}
      <h3>ğŸ“… ì‹œê°„ë³„ ê³µì • íŒë‹¨ ì˜ˆë³´</h3>
      <table border="1" cellpadding="5">
        <tr>
          <th>ì‹œê°„</th><th>ê¸°ì˜¨</th><th>ìŠµë„</th><th>í’ì†</th><th>ê°•ìˆ˜</th><th>íŒë‹¨</th>
        </tr>
        {% for f in forecast %}
        <tr>
          <td>{{ f.time }}</td>
          <td>{{ f.temp }}</td>
          <td>{{ f.humidity }}</td>
          <td>{{ f.wind }}</td>
          <td>{{ f.rain }}</td>
          <td>{{ f.judgment }}</td>
        </tr>
        {% endfor %}
      </table>
    {% endif %}

    {% if schedule %}
      <h3>ğŸ“Œ ì‹œê°„ëŒ€ë³„ ê°€ëŠ¥í•œ ê³µì • ìŠ¤ì¼€ì¤„</h3>
      <table border="1" cellpadding="5">
        <tr>
          <th>ì‹œê°„</th><th>ê°€ëŠ¥í•œ ê³µì •</th>
        </tr>
        {% for t, plist in schedule.items() %}
        <tr>
          <td>{{ t }}</td>
          <td>{{ plist | join(', ') }}</td>
        </tr>
        {% endfor %}
      </table>
    {% endif %}
  </div>

  <script>
    navigator.geolocation.getCurrentPosition(
      function (position) {
        document.getElementById("lat").value = position.coords.latitude;
        document.getElementById("lon").value = position.coords.longitude;
      },
      function (error) {
        console.warn("ğŸ“ ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error.message);
      }
    );
  </script>
</body>
</html>
